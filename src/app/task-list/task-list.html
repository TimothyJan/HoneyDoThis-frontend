<!-- Add task Form -->
<div id="form">
    <form (ngSubmit)="addTask($event)">
        <input
            class="task-input"
            type="text"
            placeholder="Add a task."
            [(ngModel)]="newTaskText"
            name="todoInput"
            [ngClass]="currentTheme + '-input'">
        <button
            class="task-btn"
            type="submit"
            [ngClass]="currentTheme + '-button'">
            Add
        </button>
    </form>
</div>

<!-- Filter Buttons -->
<div class="filter-container">
    <button
        class="filter-btn"
        [ngClass]="[
            currentTheme + '-button',
            currentFilter === 'all' ? 'active-filter' : ''
        ]"
        (click)="setFilter('all')">
        View All ({{ totalCount }})
    </button>
    <button
        class="filter-btn"
        [ngClass]="[
            currentTheme + '-button',
            currentFilter === 'active' ? 'active-filter' : ''
        ]"
        (click)="setFilter('active')">
        Active ({{ activeCount }})
    </button>
    <button
        class="filter-btn"
        [ngClass]="[
            currentTheme + '-button',
            currentFilter === 'completed' ? 'active-filter' : ''
        ]"
        (click)="setFilter('completed')">
        Completed ({{ completedCount }})
    </button>
</div>

<!-- Clear Completed Button -->
@if (hasCompletedTasks) {
    <div class="clear-container">
        <button
            class="clear-btn"
            [ngClass]="currentTheme + '-button'"
            (click)="clearCompleted()">
            Clear Completed
        </button>
    </div>
}

<!-- Drag/Drop Instructions -->
@if (!dragDisabled && filteredTasks.length > 1) {
    <div class="drag-instructions" [ngClass]="currentTheme + '-text'">
        <i class="fas fa-arrows-alt"></i> Drag tasks to reorder
    </div>
}

<!-- Task List with Drag and Drop -->
<div id="myUnOrdList">
    <div cdkDropList
         class="task-list"
         [cdkDropListDisabled]="dragDisabled"
         (cdkDropListDropped)="drop($event)">

        @for(task of filteredTasks; track task.id) {
            <div class="task"
                 cdkDrag
                 [ngClass]="[currentTheme + '-task', task.completed ? 'completed' : '']"
                 [class.fall]="task.isFalling"
                 [class.drag-disabled]="dragDisabled">

                <!-- Drag handle (only visible when drag is enabled) -->
                @if (!dragDisabled) {
                    <div class="drag-handle" cdkDragHandle>
                        <i class="fas fa-grip-vertical"></i>
                    </div>
                }

                <span class="task-item">{{ task.text }}</span>

                <div class="task-actions">
                    <button
                        class="check-btn"
                        [ngClass]="currentTheme + '-button'"
                        (click)="toggleComplete(task.id)"
                        [attr.aria-label]="task.completed ? 'Mark incomplete' : 'Mark complete'">
                        <i class="fas fa-check"></i>
                    </button>
                    <button
                        class="delete-btn"
                        [ngClass]="currentTheme + '-button'"
                        (click)="deleteTask(task.id)"
                        aria-label="Delete task">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>

                <!-- Custom drag preview -->
                <div *cdkDragPreview class="drag-preview" [ngClass]="currentTheme + '-task'">
                    <span>{{ task.text }}</span>
                    <span class="drag-preview-badge">Moving...</span>
                </div>

                <!-- Custom drag placeholder -->
                <div *cdkDragPlaceholder class="drag-placeholder"></div>
            </div>
        }

        <!-- Empty state message -->
        @if (filteredTasks.length === 0) {
            <div class="task empty-state"
                 [ngClass]="currentTheme + '-task'">
                <span class="task-item">
                    @if (currentFilter === 'all') {
                        No tasks yet. Add one above!
                    } @else if (currentFilter === 'active') {
                        No active tasks. Great job!
                    } @else {
                        No completed tasks yet.
                    }
                </span>
            </div>
        }
    </div>
</div>
